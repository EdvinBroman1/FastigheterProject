@page "/login"
@inject Data.Services.TokenService Service
@inject TestAuthStateProvider Auth
@inject NavigationManager NaviManager 

@using Microsoft.AspNetCore.Components.Authorization;
@using Fastigheter.AuthProviders

<div class="wrapper fadeInDown">
    <div id="formContent">
        <div class="fadeIn first">
            <img src="http://danielzawadzki.com/codepen/01/icon.svg" id="icon" alt="User Icon" />
        </div>

        <form>
            <input type="text" @bind="@UserName" id="username" class="fadeIn second" name="username" placeholder="Username">
            <input type="text" @bind="@Password" id="password" class="fadeIn third" name="password" placeholder="password">
            <input class="btn btn-success" @onclick="@(()=>LogIn(UserName, Password))" value="Logga In">
        </form>
    </div>
</div>
@code {
    string UserName = string.Empty;
    string Password = string.Empty;
    string token = string.Empty;


    async void LogIn(string username, string password)
    {
        token = await Service.GetTokenAsync(username, password);

        if (token.Contains("access_token"))
        {
            await Auth.Login(token);
            NaviManager.NavigateTo("", forceLoad: true);
        }
    }

}
