@page "/login"
@inject Data.Services.TokenService Service
@inject TestAuthStateProvider Auth
@inject NavigationManager NaviManager
@using Fastigheter.AuthProviders

<div class="col-md-6 offset-md-3 mt-5">
    <div class="card">
        <h4 class="card-header">Välkommen till Fastigheter Red</h4>
        <div class="card-body">
            <img src="https://toppng.com/uploads/preview/app-icon-set-login-icon-comments-avatar-icon-11553436380yill0nchdm.png" 
                 alt="ikon kunde ej laddas" height="40" width="40" />
            <EditForm Model="@model" OnSubmit="LogIn">
                <DataAnnotationsValidator />
                <div class="form-group">
                    <label>Username</label>
                    <InputText @bind-Value="model.UserName" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <InputText @bind-Value="model.Password" type="password" class="form-control" />
                </div>
                <button class="btn btn-primary">
                    Logga in
                </button>
            </EditForm>
        </div>
    </div>
</div>
    @code {
        private LoginModel model = new LoginModel();
        string token = string.Empty;


        async void LogIn()
        {
            token = await Service.GetTokenAsync(model.UserName, model.Password);

            if (token.Contains("access_token"))
            {
                await Auth.Login(token);
                NaviManager.NavigateTo("", forceLoad: true);
            }
        }

        private class LoginModel
        {
            [Required]
            [DataType(DataType.Text)]
            public string UserName { get; set; }
            [Required]
            [DataType(DataType.Password)]
            public string Password { get; set; }
        }
    }
